<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Landing Page Builder</title>
  <style>
    :root{
      --bg:#0b1220;
      --panel:#0f1a30;
      --panel2:#0c162a;
      --text:#e8eefc;
      --muted:#a9b5d6;
      --line:rgba(255,255,255,.10);
      --accent:#6ea8ff;
      --accent2:#c17cff;
      --good:#4fe3a3;
      --warn:#ffcc66;
      --bad:#ff6b7a;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --r:18px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:var(--sans);
      background:
        radial-gradient(900px 500px at 10% 10%, rgba(110,168,255,.20), transparent 55%),
        radial-gradient(900px 500px at 90% 20%, rgba(193,124,255,.18), transparent 60%),
        radial-gradient(900px 500px at 50% 95%, rgba(79,227,163,.10), transparent 60%),
        linear-gradient(180deg, #070c16, var(--bg) 55%, #060a12);
      color:var(--text);
    }

    a{color:inherit}
    button, input, textarea, select{font:inherit}

    .app{
      display:grid;
      grid-template-columns: 420px 1fr;
      gap:16px;
      padding:16px;
      min-height:100vh;
    }

    .panel{
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border:1px solid var(--line);
      border-radius: var(--r);
      box-shadow: var(--shadow);
      overflow:hidden;
    }

    .left{
      position:sticky;
      top:16px;
      height: calc(100vh - 32px);
      display:flex;
      flex-direction:column;
      min-width: 320px;
    }

    .header{
      padding:14px 16px;
      border-bottom:1px solid var(--line);
      background: linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.02));
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }

    .header h1{
      font-size:14px;
      letter-spacing:.6px;
      margin:0;
      text-transform:uppercase;
      color: var(--muted);
    }

    .header .badge{
      font-size:12px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.04);
      color: var(--muted);
      white-space:nowrap;
    }

    .controls{
      padding:12px 12px 0;
      overflow:auto;
    }

    .section{
      border:1px solid var(--line);
      border-radius: 14px;
      background: rgba(0,0,0,.14);
      margin: 0 0 12px;
      overflow:hidden;
    }

    .section summary{
      list-style:none;
      cursor:pointer;
      padding:12px 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      user-select:none;
    }
    .section summary::-webkit-details-marker{display:none}

    .section summary .title{
      font-weight:700;
      font-size:13px;
      letter-spacing:.2px;
    }

    .section summary .hint{
      font-size:12px;
      color: var(--muted);
    }

    .grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
      padding: 0 12px 12px;
    }
    .grid.one{grid-template-columns:1fr}

    label{
      display:flex;
      flex-direction:column;
      gap:6px;
      font-size:12px;
      color: var(--muted);
    }

    input[type="text"], input[type="url"], input[type="email"], input[type="tel"], input[type="number"], textarea, select{
      background: rgba(255,255,255,.05);
      border: 1px solid var(--line);
      border-radius: 12px;
      padding: 10px 10px;
      color: var(--text);
      outline: none;
    }

    textarea{min-height:88px; resize:vertical}

    .row{
      display:flex;
      gap:10px;
      align-items:center;
      padding: 0 12px 12px;
      flex-wrap:wrap;
    }

    .btn{
      appearance:none;
      border:1px solid var(--line);
      background: rgba(255,255,255,.06);
      color: var(--text);
      padding:10px 12px;
      border-radius: 12px;
      cursor:pointer;
      transition: transform .08s ease, background .15s ease;
      font-weight:700;
      font-size:13px;
      display:inline-flex;
      align-items:center;
      gap:8px;
      user-select:none;
    }
    .btn:active{transform: translateY(1px)}
    .btn.primary{background: linear-gradient(90deg, rgba(110,168,255,.22), rgba(193,124,255,.18)); border-color: rgba(110,168,255,.35)}
    .btn.good{background: linear-gradient(90deg, rgba(79,227,163,.18), rgba(110,168,255,.10)); border-color: rgba(79,227,163,.40)}
    .btn.warn{background: rgba(255,204,102,.14); border-color: rgba(255,204,102,.32)}
    .btn.bad{background: rgba(255,107,122,.14); border-color: rgba(255,107,122,.32)}

    .tiny{
      font-size:12px;
      color: var(--muted);
      padding: 0 12px 12px;
      line-height:1.35;
    }

    .previewWrap{
      display:flex;
      flex-direction:column;
      min-height: calc(100vh - 32px);
    }

    .previewTop{
      padding: 14px 16px;
      border-bottom:1px solid var(--line);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
    }

    .previewTop .leftBits{
      display:flex;
      flex-direction:column;
      gap:4px;
      min-width:260px;
    }

    .previewTop .leftBits .k{
      font-size:12px;
      color: var(--muted);
      letter-spacing:.4px;
      text-transform:uppercase;
    }

    .previewTop .leftBits .v{
      font-weight:900;
      letter-spacing:.2px;
    }

    .previewTop .actions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
      margin-left:auto;
    }

    iframe{
      width:100%;
      height:100%;
      border:0;
      border-radius: 0 0 var(--r) var(--r);
      background:#0a1020;
      flex:1;
    }

    .kpi{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
    }

    .pill{
      display:inline-flex;
      gap:8px;
      align-items:center;
      border:1px solid var(--line);
      border-radius:999px;
      padding:7px 10px;
      background: rgba(255,255,255,.04);
      color: var(--muted);
      font-size:12px;
      white-space:nowrap;
    }

    .dot{width:9px;height:9px;border-radius:999px;background: var(--good)}
    .dot.bad{background: var(--bad)}

    @media (max-width: 980px){
      .app{grid-template-columns:1fr}
      .left{position:relative;height:auto}
      .previewWrap{min-height: 70vh}
    }
  </style>
</head>
<body>
  <div class="app">

    <!-- LEFT: BUILDER CONTROLS -->
    <div class="panel left" id="builder">
      <div class="header">
        <h1>Landing Page Builder</h1>
        <div class="badge">single-file ‚Ä¢ no backend ‚Ä¢ exports index.html</div>
      </div>

      <div class="controls">

        <details class="section" open>
          <summary>
            <div class="title">Brand + Layout</div>
            <div class="hint">name, theme, hero</div>
          </summary>
          <div class="grid">
            <label>Display Name
              <input id="displayName" type="text" placeholder="DevSkits916" />
            </label>
            <label>Headline
              <input id="headline" type="text" placeholder="All my links in one place" />
            </label>
            <label>Subheadline
              <input id="subheadline" type="text" placeholder="Social ‚Ä¢ Payments ‚Ä¢ Contact" />
            </label>
            <label>Accent Color
              <input id="accent" type="text" placeholder="#6ea8ff" />
            </label>
            <label>Background Mode
              <select id="bgMode">
                <option value="aurora">Aurora</option>
                <option value="solid">Solid</option>
                <option value="gradient">Gradient</option>
              </select>
            </label>
            <label>Background Color / Base
              <input id="bgBase" type="text" placeholder="#0b1220" />
            </label>
          </div>
          <div class="grid one">
            <label>Avatar (Image URL or data URL)
              <input id="avatarUrl" type="url" placeholder="https://... or data:image/png;base64,..." />
            </label>
          </div>
        </details>

        <details class="section" open>
          <summary>
            <div class="title">Contact Info</div>
            <div class="hint">email, phone, location</div>
          </summary>
          <div class="grid">
            <label>Email
              <input id="email" type="email" placeholder="name@domain.com" />
            </label>
            <label>Phone
              <input id="phone" type="tel" placeholder="(555) 555-5555" />
            </label>
            <label>Location
              <input id="location" type="text" placeholder="Sacramento, CA" />
            </label>
            <label>Website
              <input id="website" type="url" placeholder="https://example.com" />
            </label>
          </div>
        </details>

        <details class="section" open>
          <summary>
            <div class="title">Links</div>
            <div class="hint">social + payments + custom</div>
          </summary>
          <div class="tiny">Add any link as a button. Categories drive grouping in the preview (Social / Payments / Contact / Other). Icons are optional.</div>
          <div class="row">
            <button class="btn good" id="addLinkBtn">‚ûï Add Link</button>
            <button class="btn" id="addDefaultsBtn">‚ú® Add common defaults</button>
            <button class="btn bad" id="clearLinksBtn">üßπ Clear links</button>
          </div>
          <div class="tiny" id="linkCount">0 links</div>
          <div id="linksContainer" style="padding:0 12px 12px; display:flex; flex-direction:column; gap:10px;"></div>
        </details>

        <details class="section">
          <summary>
            <div class="title">Footer + SEO</div>
            <div class="hint">title, description</div>
          </summary>
          <div class="grid">
            <label>Page Title
              <input id="pageTitle" type="text" placeholder="DevSkits916 | Links" />
            </label>
            <label>Meta Description
              <input id="metaDesc" type="text" placeholder="Social, payments, and contact links" />
            </label>
          </div>
          <div class="grid one">
            <label>Footer Note
              <textarea id="footerNote" placeholder="Made with questionable life choices."></textarea>
            </label>
          </div>
        </details>

        <details class="section">
          <summary>
            <div class="title">Data</div>
            <div class="hint">save/load builder settings</div>
          </summary>
          <div class="row">
            <button class="btn primary" id="saveStateBtn">üíæ Save to browser</button>
            <button class="btn" id="loadStateBtn">üì• Load from browser</button>
            <button class="btn warn" id="resetStateBtn">‚ôªÔ∏è Reset</button>
          </div>
          <div class="tiny">Saving uses localStorage in this browser only. No server. No magic.</div>
        </details>

        <div class="row" style="padding-bottom:14px">
          <button class="btn primary" id="exportBtn">‚¨áÔ∏è Export index.html</button>
          <button class="btn" id="copyHtmlBtn">üìã Copy HTML</button>
        </div>

        <div class="tiny">
          Tips:
          <ul style="margin:8px 0 0 18px; padding:0; color:var(--muted)">
            <li>Paste image data URLs for the avatar if you want a single-file result.</li>
            <li>All links are editable, reorderable, and toggleable.</li>
            <li>Exported file is a standalone landing page, not the builder.</li>
          </ul>
        </div>

      </div>
    </div>

    <!-- RIGHT: PREVIEW -->
    <div class="panel previewWrap">
      <div class="previewTop">
        <div class="leftBits">
          <div class="k">Live Preview</div>
          <div class="v">Your landing page updates instantly</div>
          <div class="kpi" style="margin-top:6px">
            <span class="pill"><span class="dot" id="validDot"></span><span id="validText">All good</span></span>
            <span class="pill"><span style="font-family:var(--mono)">index.html</span> ready to export</span>
          </div>
        </div>
        <div class="actions">
          <button class="btn" id="openInNewTabBtn">üß™ Open preview in new tab</button>
          <button class="btn" id="downloadJsonBtn">‚¨áÔ∏è Download settings .json</button>
          <button class="btn" id="importJsonBtn">üì• Import settings .json</button>
          <input id="importJsonFile" type="file" accept="application/json" style="display:none" />
        </div>
      </div>
      <iframe id="preview" title="preview"></iframe>
    </div>

  </div>

<script>
(() => {
  // --- State ---
  const DEFAULTS = {
    displayName: "DevSkits916",
    headline: "All my links in one place",
    subheadline: "Social ‚Ä¢ Payments ‚Ä¢ Contact",
    accent: "#6ea8ff",
    bgMode: "aurora",
    bgBase: "#0b1220",
    avatarUrl: "",
    email: "",
    phone: "",
    location: "",
    website: "",
    pageTitle: "Links",
    metaDesc: "All platforms and contact info in one page.",
    footerNote: "",
    links: []
  };

  // A link item: { id, label, url, category, icon, enabled }
  const COMMON_DEFAULTS = [
    { label: "Facebook", url: "", category: "social", icon: "facebook", enabled: true },
    { label: "Instagram", url: "", category: "social", icon: "instagram", enabled: true },
    { label: "X (Twitter)", url: "", category: "social", icon: "x", enabled: true },
    { label: "TikTok", url: "", category: "social", icon: "tiktok", enabled: true },
    { label: "YouTube", url: "", category: "social", icon: "youtube", enabled: true },
    { label: "Reddit", url: "", category: "social", icon: "reddit", enabled: true },
    { label: "GitHub", url: "", category: "social", icon: "github", enabled: true },

    { label: "Venmo", url: "", category: "payments", icon: "venmo", enabled: true },
    { label: "Cash App", url: "", category: "payments", icon: "cashapp", enabled: true },
    { label: "PayPal", url: "", category: "payments", icon: "paypal", enabled: true },
    { label: "Chime", url: "", category: "payments", icon: "bank", enabled: true },
    { label: "GoFundMe", url: "", category: "payments", icon: "heart", enabled: true },

    { label: "Email", url: "mailto:", category: "contact", icon: "mail", enabled: true },
    { label: "Call", url: "tel:", category: "contact", icon: "phone", enabled: true },
    { label: "Website", url: "", category: "contact", icon: "link", enabled: true }
  ];

  const uid = () => Math.random().toString(16).slice(2) + Date.now().toString(16);

  let state = structuredClone(DEFAULTS);

  // --- Elements ---
  const $ = (id) => document.getElementById(id);
  const el = {
    displayName: $("displayName"),
    headline: $("headline"),
    subheadline: $("subheadline"),
    accent: $("accent"),
    bgMode: $("bgMode"),
    bgBase: $("bgBase"),
    avatarUrl: $("avatarUrl"),
    email: $("email"),
    phone: $("phone"),
    location: $("location"),
    website: $("website"),
    pageTitle: $("pageTitle"),
    metaDesc: $("metaDesc"),
    footerNote: $("footerNote"),

    linksContainer: $("linksContainer"),
    linkCount: $("linkCount"),

    preview: $("preview"),
    exportBtn: $("exportBtn"),
    copyHtmlBtn: $("copyHtmlBtn"),
    addLinkBtn: $("addLinkBtn"),
    addDefaultsBtn: $("addDefaultsBtn"),
    clearLinksBtn: $("clearLinksBtn"),
    openInNewTabBtn: $("openInNewTabBtn"),

    saveStateBtn: $("saveStateBtn"),
    loadStateBtn: $("loadStateBtn"),
    resetStateBtn: $("resetStateBtn"),

    validDot: $("validDot"),
    validText: $("validText"),

    downloadJsonBtn: $("downloadJsonBtn"),
    importJsonBtn: $("importJsonBtn"),
    importJsonFile: $("importJsonFile"),
  };

  // --- Helpers ---
  const safeTrim = (v) => (typeof v === "string" ? v.trim() : v);

  function setInputValuesFromState(){
    el.displayName.value = state.displayName;
    el.headline.value = state.headline;
    el.subheadline.value = state.subheadline;
    el.accent.value = state.accent;
    el.bgMode.value = state.bgMode;
    el.bgBase.value = state.bgBase;
    el.avatarUrl.value = state.avatarUrl;

    el.email.value = state.email;
    el.phone.value = state.phone;
    el.location.value = state.location;
    el.website.value = state.website;

    el.pageTitle.value = state.pageTitle;
    el.metaDesc.value = state.metaDesc;
    el.footerNote.value = state.footerNote;

    renderLinksEditor();
    updateAll();
  }

  function readStateFromInputs(){
    state.displayName = safeTrim(el.displayName.value);
    state.headline = safeTrim(el.headline.value);
    state.subheadline = safeTrim(el.subheadline.value);
    state.accent = safeTrim(el.accent.value);
    state.bgMode = el.bgMode.value;
    state.bgBase = safeTrim(el.bgBase.value);
    state.avatarUrl = safeTrim(el.avatarUrl.value);

    state.email = safeTrim(el.email.value);
    state.phone = safeTrim(el.phone.value);
    state.location = safeTrim(el.location.value);
    state.website = safeTrim(el.website.value);

    state.pageTitle = safeTrim(el.pageTitle.value);
    state.metaDesc = safeTrim(el.metaDesc.value);
    state.footerNote = el.footerNote.value ?? "";
  }

  function downloadText(filename, text){
    const blob = new Blob([text], {type: "text/html;charset=utf-8"});
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    a.remove();
    setTimeout(() => URL.revokeObjectURL(a.href), 250);
  }

  function downloadJson(filename, obj){
    const blob = new Blob([JSON.stringify(obj, null, 2)], {type: "application/json;charset=utf-8"});
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    a.remove();
    setTimeout(() => URL.revokeObjectURL(a.href), 250);
  }

  async function copyText(text){
    try{
      await navigator.clipboard.writeText(text);
      toast("Copied to clipboard");
    }catch{
      // fallback
      const t = document.createElement('textarea');
      t.value = text;
      document.body.appendChild(t);
      t.select();
      document.execCommand('copy');
      t.remove();
      toast("Copied to clipboard");
    }
  }

  function toast(msg){
    const n = document.createElement('div');
    n.textContent = msg;
    n.style.position='fixed';
    n.style.bottom='16px';
    n.style.left='50%';
    n.style.transform='translateX(-50%)';
    n.style.background='rgba(0,0,0,.75)';
    n.style.color='#fff';
    n.style.padding='10px 12px';
    n.style.border='1px solid rgba(255,255,255,.18)';
    n.style.borderRadius='12px';
    n.style.zIndex='9999';
    n.style.fontSize='13px';
    n.style.maxWidth='92vw';
    n.style.boxShadow='0 10px 30px rgba(0,0,0,.35)';
    document.body.appendChild(n);
    setTimeout(() => { n.style.opacity='0'; n.style.transition='opacity .18s ease'; }, 1200);
    setTimeout(() => n.remove(), 1450);
  }

  function normalizeUrl(url){
    const u = (url || "").trim();
    if (!u) return "";
    if (u.startsWith("mailto:") || u.startsWith("tel:") || u.startsWith("sms:") || u.startsWith("https://") || u.startsWith("http://")) return u;
    // if user typed @handle for X etc, leave it. They can paste full URL.
    if (u.startsWith("@")) return u;
    // best-effort add https
    return "https://" + u;
  }

  function isProbablyUrl(u){
    if (!u) return false;
    if (u.startsWith('mailto:') || u.startsWith('tel:')) return true;
    try{ new URL(u); return true; }catch{}
    // allow @handles as "valid" because people do that
    if (u.startsWith('@')) return true;
    return false;
  }

  function validate(){
    const issues = [];

    if (!state.displayName) issues.push("Display name is empty");

    for (const l of state.links){
      if (!l.enabled) continue;
      if (!l.label?.trim()) issues.push("A link has an empty label");
      const u = (l.url || "").trim();
      if (!u) issues.push(`‚Äú${l.label || 'Unnamed'}‚Äù has an empty URL`);
      else if (!isProbablyUrl(u)) issues.push(`‚Äú${l.label || 'Unnamed'}‚Äù URL looks wrong`);
    }

    // Mark status
    if (issues.length){
      el.validDot.classList.add('bad');
      el.validText.textContent = issues.length === 1 ? issues[0] : `${issues.length} issues (export still works)`;
    } else {
      el.validDot.classList.remove('bad');
      el.validText.textContent = "All good";
    }

    return issues;
  }

  // --- Links editor ---
  const CATEGORY_OPTS = [
    {v:"social", t:"Social"},
    {v:"payments", t:"Payments"},
    {v:"contact", t:"Contact"},
    {v:"other", t:"Other"},
  ];

  function renderLinksEditor(){
    el.linksContainer.innerHTML = "";

    state.links.forEach((link, idx) => {
      const card = document.createElement('div');
      card.style.border = '1px solid rgba(255,255,255,.10)';
      card.style.background = 'rgba(255,255,255,.04)';
      card.style.borderRadius = '14px';
      card.style.padding = '10px';
      card.style.display = 'grid';
      card.style.gridTemplateColumns = '1fr 1fr';
      card.style.gap = '10px';

      const mkLabel = (text) => {
        const l = document.createElement('label');
        l.textContent = text;
        l.style.display='flex';
        l.style.flexDirection='column';
        l.style.gap='6px';
        l.style.fontSize='12px';
        l.style.color='rgba(233,240,255,.70)';
        return l;
      };

      const label = mkLabel('Button label');
      const labelIn = document.createElement('input');
      labelIn.type = 'text';
      labelIn.value = link.label || "";
      labelIn.placeholder = 'e.g., GitHub';
      labelIn.style.background='rgba(0,0,0,.22)';
      labelIn.style.border='1px solid rgba(255,255,255,.10)';
      labelIn.style.borderRadius='12px';
      labelIn.style.padding='10px';
      labelIn.style.color='inherit';
      label.appendChild(labelIn);

      const url = mkLabel('URL');
      const urlIn = document.createElement('input');
      urlIn.type = 'text';
      urlIn.value = link.url || "";
      urlIn.placeholder = 'https://...  or mailto:...  or tel:...';
      urlIn.style.background='rgba(0,0,0,.22)';
      urlIn.style.border='1px solid rgba(255,255,255,.10)';
      urlIn.style.borderRadius='12px';
      urlIn.style.padding='10px';
      urlIn.style.color='inherit';
      url.appendChild(urlIn);

      const cat = mkLabel('Category');
      const catSel = document.createElement('select');
      catSel.style.background='rgba(0,0,0,.22)';
      catSel.style.border='1px solid rgba(255,255,255,.10)';
      catSel.style.borderRadius='12px';
      catSel.style.padding='10px';
      catSel.style.color='inherit';
      for (const o of CATEGORY_OPTS){
        const opt = document.createElement('option');
        opt.value = o.v;
        opt.textContent = o.t;
        catSel.appendChild(opt);
      }
      catSel.value = link.category || 'other';
      cat.appendChild(catSel);

      const icon = mkLabel('Icon (optional)');
      const iconIn = document.createElement('input');
      iconIn.type = 'text';
      iconIn.value = link.icon || "";
      iconIn.placeholder = 'e.g., github / paypal / phone';
      iconIn.style.background='rgba(0,0,0,.22)';
      iconIn.style.border='1px solid rgba(255,255,255,.10)';
      iconIn.style.borderRadius='12px';
      iconIn.style.padding='10px';
      iconIn.style.color='inherit';
      icon.appendChild(iconIn);

      const actions = document.createElement('div');
      actions.style.gridColumn='1 / -1';
      actions.style.display='flex';
      actions.style.gap='10px';
      actions.style.flexWrap='wrap';
      actions.style.alignItems='center';

      const enabled = document.createElement('label');
      enabled.style.display='inline-flex';
      enabled.style.alignItems='center';
      enabled.style.gap='8px';
      enabled.style.fontSize='12px';
      enabled.style.color='rgba(233,240,255,.70)';
      const chk = document.createElement('input');
      chk.type='checkbox';
      chk.checked = !!link.enabled;
      enabled.appendChild(chk);
      enabled.appendChild(document.createTextNode('Enabled'));

      const up = document.createElement('button');
      up.className='btn';
      up.type='button';
      up.textContent='‚¨ÜÔ∏è Up';
      up.disabled = idx === 0;

      const down = document.createElement('button');
      down.className='btn';
      down.type='button';
      down.textContent='‚¨áÔ∏è Down';
      down.disabled = idx === state.links.length - 1;

      const del = document.createElement('button');
      del.className='btn bad';
      del.type='button';
      del.textContent='üóëÔ∏è Delete';

      const normalize = document.createElement('button');
      normalize.className='btn';
      normalize.type='button';
      normalize.textContent='üîß Normalize URL';

      actions.appendChild(enabled);
      actions.appendChild(up);
      actions.appendChild(down);
      actions.appendChild(normalize);
      actions.appendChild(del);

      // Bind events
      const sync = () => {
        link.label = labelIn.value;
        link.url = urlIn.value;
        link.category = catSel.value;
        link.icon = iconIn.value;
        link.enabled = chk.checked;
        updateAll();
      };

      labelIn.addEventListener('input', sync);
      urlIn.addEventListener('input', sync);
      catSel.addEventListener('change', sync);
      iconIn.addEventListener('input', sync);
      chk.addEventListener('change', sync);

      normalize.addEventListener('click', () => {
        link.url = normalizeUrl(link.url);
        urlIn.value = link.url;
        updateAll();
      });

      up.addEventListener('click', () => {
        if (idx === 0) return;
        const a = state.links[idx-1];
        state.links[idx-1] = state.links[idx];
        state.links[idx] = a;
        renderLinksEditor();
        updateAll();
      });

      down.addEventListener('click', () => {
        if (idx >= state.links.length-1) return;
        const a = state.links[idx+1];
        state.links[idx+1] = state.links[idx];
        state.links[idx] = a;
        renderLinksEditor();
        updateAll();
      });

      del.addEventListener('click', () => {
        state.links.splice(idx, 1);
        renderLinksEditor();
        updateAll();
      });

      card.appendChild(label);
      card.appendChild(url);
      card.appendChild(cat);
      card.appendChild(icon);
      card.appendChild(actions);

      el.linksContainer.appendChild(card);
    });

    el.linkCount.textContent = `${state.links.length} link${state.links.length===1?'':'s'}`;
  }

  function addLink(partial={}){
    state.links.push({
      id: uid(),
      label: partial.label ?? "New link",
      url: partial.url ?? "",
      category: partial.category ?? "other",
      icon: partial.icon ?? "",
      enabled: partial.enabled ?? true
    });
    renderLinksEditor();
    updateAll();
  }

  // --- Exported landing page generation ---
  function escapeHtml(s){
    return String(s ?? "")
      .replaceAll('&','&amp;')
      .replaceAll('<','&lt;')
      .replaceAll('>','&gt;')
      .replaceAll('"','&quot;')
      .replaceAll("'",'&#39;');
  }

  function buildLandingPageHtml(cfg){
    const config = structuredClone(cfg);

    // Build contact cards into links if missing (optional: keep separate)
    const contact = [];
    if (config.email) contact.push({ label:"Email", url:`mailto:${config.email}`, category:"contact", icon:"mail", enabled:true });
    if (config.phone) contact.push({ label:"Call", url:`tel:${config.phone.replace(/[^+0-9]/g,'')}`, category:"contact", icon:"phone", enabled:true });
    if (config.website) contact.push({ label:"Website", url: config.website, category:"contact", icon:"link", enabled:true });

    // Merge, but avoid duplicates by label+url
    const existing = new Set((config.links||[]).map(l => `${(l.label||'').trim().toLowerCase()}|${(l.url||'').trim().toLowerCase()}`));
    for (const c of contact){
      const key = `${c.label.toLowerCase()}|${c.url.toLowerCase()}`;
      if (!existing.has(key)) config.links.push({ ...c, id: uid() });
    }

    const groups = {
      social: [],
      payments: [],
      contact: [],
      other: []
    };

    for (const l of (config.links||[])){
      if (!l || !l.enabled) continue;
      const cat = (l.category || 'other').toLowerCase();
      (groups[cat] || groups.other).push(l);
    }

    const iconSvg = (name) => {
      // Simple inline icons. Not exhaustive. It's fine.
      const n = (name||"").toLowerCase().trim();
      const base = `fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"`;
      const w = `width="20" height="20" viewBox="0 0 24 24" aria-hidden="true"`;

      if (n === 'mail') return `<svg ${w} ${base}><path d="M4 4h16v16H4z" opacity=".2"/><path d="M4 8l8 5 8-5"/><path d="M4 6h16"/></svg>`;
      if (n === 'phone') return `<svg ${w} ${base}><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.8 19.8 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6A19.8 19.8 0 0 1 2.11 4.18 2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72c.12.86.3 1.7.54 2.5a2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.58-1.11a2 2 0 0 1 2.11-.45c.8.24 1.64.42 2.5.54A2 2 0 0 1 22 16.92z"/></svg>`;
      if (n === 'link') return `<svg ${w} ${base}><path d="M10 13a5 5 0 0 1 0-7l1-1a5 5 0 0 1 7 7l-1 1"/><path d="M14 11a5 5 0 0 1 0 7l-1 1a5 5 0 0 1-7-7l1-1"/></svg>`;
      if (n === 'heart') return `<svg ${w} ${base}><path d="M20.8 4.6a5.5 5.5 0 0 0-7.8 0L12 5.6l-1-1a5.5 5.5 0 0 0-7.8 7.8l1 1L12 22l7.8-7.6 1-1a5.5 5.5 0 0 0 0-7.8z"/></svg>`;
      if (n === 'github') return `<svg ${w} viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M12 .5a12 12 0 0 0-3.8 23.4c.6.1.8-.3.8-.6v-2.1c-3.2.7-3.9-1.3-3.9-1.3-.5-1.2-1.2-1.6-1.2-1.6-1-.7.1-.7.1-.7 1.1.1 1.7 1.1 1.7 1.1 1 1.7 2.7 1.2 3.3.9.1-.7.4-1.2.7-1.5-2.6-.3-5.3-1.3-5.3-5.8 0-1.3.5-2.4 1.2-3.3-.1-.3-.5-1.5.1-3.1 0 0 1-.3 3.3 1.2a11.4 11.4 0 0 1 6 0C17.4 5 18.4 5.3 18.4 5.3c.6 1.6.2 2.8.1 3.1.8.9 1.2 2 1.2 3.3 0 4.5-2.7 5.5-5.3 5.8.4.3.8 1 .8 2.1v3.1c0 .3.2.7.8.6A12 12 0 0 0 12 .5z"/></svg>`;
      if (n === 'reddit') return `<svg ${w} viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M24 12c0-6.6-5.4-12-12-12S0 5.4 0 12c0 6 4.4 11 10.2 11.9-.1-.3-.2-.8-.1-1.2l.4-1.6c-2.1.4-2.7-1-2.7-1-.4-.9-1-1.2-1-1.2-.8-.6.1-.6.1-.6.9.1 1.4.9 1.4.9.8 1.4 2.1 1 2.6.8.1-.6.3-1 .6-1.2-1.7-.2-3.5-.9-3.5-3.8 0-.8.3-1.5.8-2-.1-.2-.3-1 .1-2 0 0 .6-.2 2 .8.6-.2 1.2-.3 1.9-.3s1.3.1 1.9.3c1.4-1 2-.8 2-.8.4 1 .2 1.8.1 2 .5.5.8 1.2.8 2 0 2.9-1.8 3.6-3.5 3.8.3.3.6.8.6 1.6l-.1 2.4c0 .2 0 .4-.1.6C19.6 23 24 18 24 12z"/></svg>`;

      // Generic icon
      return `<svg ${w} ${base}><circle cx="12" cy="12" r="9" opacity=".15"/><path d="M8 12h8"/><path d="M12 8v8"/></svg>`;
    };

    const accent = (config.accent || "#6ea8ff").trim();
    const bgBase = (config.bgBase || "#0b1220").trim();

    const bgCss = (() => {
      if (config.bgMode === 'solid'){
        return `background: ${bgBase};`;
      }
      if (config.bgMode === 'gradient'){
        return `background: radial-gradient(900px 500px at 10% 10%, color-mix(in srgb, ${accent} 30%, transparent), transparent 55%),\n                  radial-gradient(900px 500px at 90% 20%, rgba(193,124,255,.18), transparent 60%),\n                  linear-gradient(180deg, #070c16, ${bgBase} 55%, #060a12);`;
      }
      // aurora
      return `background:\n        radial-gradient(900px 500px at 10% 10%, color-mix(in srgb, ${accent} 32%, transparent), transparent 55%),\n        radial-gradient(900px 500px at 90% 20%, rgba(193,124,255,.18), transparent 60%),\n        radial-gradient(900px 500px at 50% 95%, rgba(79,227,163,.10), transparent 60%),\n        linear-gradient(180deg, #070c16, ${bgBase} 55%, #060a12);`;
    })();

    const avatar = config.avatarUrl?.trim();

    const sectionHtml = (title, items) => {
      if (!items || !items.length) return "";
      const cards = items.map((l) => {
        const url = escapeHtml((l.url||"").trim());
        const label = escapeHtml((l.label||"").trim());
        const icon = escapeHtml((l.icon||"").trim());
        const iconMarkup = icon ? iconSvg(icon) : iconSvg('link');
        // Allow @handles but still link: if starts with @ we won't convert because no platform known.
        const href = url.startsWith('@') ? '#' : url;
        const dataHint = url.startsWith('@') ? `data-handle="${url}"` : '';

        return `
          <a class="card" href="${href}" target="_blank" rel="noopener noreferrer" ${dataHint}>
            <span class="ico">${iconMarkup}</span>
            <span class="txt">
              <span class="lbl">${label}</span>
              <span class="sub">${escapeHtml(url)}</span>
            </span>
            <span class="chev" aria-hidden="true">‚Ä∫</span>
          </a>
        `;
      }).join('');

      return `
        <section class="block">
          <h2>${escapeHtml(title)}</h2>
          <div class="cards">${cards}</div>
        </section>
      `;
    };

    const docTitle = escapeHtml(config.pageTitle || `${config.displayName || 'Links'}`);
    const metaDesc = escapeHtml(config.metaDesc || "");

    // A tiny script to handle @handles by copying them.
    // Also adds a minimal QR toggle using the Web Share API if available.
    return `<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>${docTitle}</title>
  <meta name="description" content="${metaDesc}" />
  <style>
    :root{
      --bgBase:${escapeHtml(bgBase)};
      --accent:${escapeHtml(accent)};
      --text:#e8eefc;
      --muted:#a9b5d6;
      --line:rgba(255,255,255,.12);
      --panel: rgba(255,255,255,.06);
      --shadow: 0 18px 40px rgba(0,0,0,.40);
      --r:18px;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: var(--sans);
      color: var(--text);
      ${bgCss}
    }
    a{color:inherit; text-decoration:none}

    .wrap{max-width: 860px; margin: 0 auto; padding: 24px 14px 40px;}

    .hero{
      display:flex;
      gap:16px;
      align-items:center;
      border:1px solid var(--line);
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.04));
      border-radius: calc(var(--r) + 4px);
      box-shadow: var(--shadow);
      padding: 18px;
      backdrop-filter: blur(10px);
    }

    .avatar{
      width: 72px; height: 72px;
      border-radius: 18px;
      border: 1px solid var(--line);
      background: rgba(0,0,0,.20);
      overflow:hidden;
      display:flex;
      align-items:center;
      justify-content:center;
      flex:0 0 auto;
    }
    .avatar img{width:100%; height:100%; object-fit:cover; display:block}

    .hero .t{display:flex; flex-direction:column; gap:5px; min-width:0}
    .name{font-weight: 900; font-size: 22px; letter-spacing:.2px;}
    .headline{font-weight: 800; color: var(--muted);}
    .sub{color: var(--muted); font-size: 13px; line-height:1.35}

    .topActions{margin-left:auto; display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end}
    .btn{
      border:1px solid var(--line);
      background: rgba(0,0,0,.22);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 12px;
      font-weight: 800;
      font-size: 13px;
      cursor:pointer;
    }
    .btn.primary{background: color-mix(in srgb, var(--accent) 20%, rgba(0,0,0,.22)); border-color: color-mix(in srgb, var(--accent) 35%, rgba(255,255,255,.10))}

    .block{margin-top: 16px;}
    h2{
      margin: 0 0 10px;
      font-size: 12px;
      letter-spacing: .6px;
      text-transform: uppercase;
      color: var(--muted);
    }

    .cards{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }

    .card{
      display:flex;
      align-items:center;
      gap: 10px;
      padding: 12px 12px;
      border-radius: var(--r);
      border: 1px solid var(--line);
      background: rgba(0,0,0,.18);
      transition: transform .08s ease, background .15s ease, border-color .15s ease;
      min-height: 58px;
    }
    .card:hover{transform: translateY(-1px); background: rgba(0,0,0,.26); border-color: color-mix(in srgb, var(--accent) 30%, var(--line))}

    .ico{display:inline-flex; width: 36px; height: 36px; align-items:center; justify-content:center;
      border-radius: 14px; border:1px solid var(--line);
      background: color-mix(in srgb, var(--accent) 14%, rgba(0,0,0,.18));
      color: var(--text);
      flex:0 0 auto;
    }

    .txt{display:flex; flex-direction:column; gap:2px; min-width:0; flex:1}
    .lbl{font-weight: 900}
    .sub{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; font-size: 12px; opacity:.75; overflow:hidden; text-overflow:ellipsis; white-space:nowrap}
    .chev{opacity:.6; font-size: 22px; margin-left:auto}

    .contactRow{display:flex; gap:10px; flex-wrap:wrap; margin-top: 12px; color: var(--muted); font-size: 13px;}
    .chip{border:1px solid var(--line); background: rgba(0,0,0,.15); border-radius:999px; padding: 8px 10px; display:inline-flex; gap:8px; align-items:center;}
    .dot{width:8px;height:8px;border-radius:999px;background: var(--accent)}

    footer{margin-top: 18px; color: var(--muted); font-size: 12px; text-align:center; opacity:.85}

    @media (max-width: 780px){
      .cards{grid-template-columns: 1fr;}
      .hero{flex-wrap:wrap}
      .topActions{margin-left:0}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="hero">
      <div class="avatar">${avatar ? `<img alt="avatar" src="${escapeHtml(avatar)}"/>` : `<span style="opacity:.7; font-weight:900">${escapeHtml((config.displayName||'').slice(0,2).toUpperCase() || 'LP')}</span>`}</div>
      <div class="t">
        <div class="name">${escapeHtml(config.displayName || 'Links')}</div>
        <div class="headline">${escapeHtml(config.headline || '')}</div>
        <div class="sub">${escapeHtml(config.subheadline || '')}</div>
        <div class="contactRow">
          ${config.location ? `<span class="chip"><span class="dot"></span>${escapeHtml(config.location)}</span>` : ''}
          ${config.email ? `<span class="chip"><span class="dot"></span>${escapeHtml(config.email)}</span>` : ''}
          ${config.phone ? `<span class="chip"><span class="dot"></span>${escapeHtml(config.phone)}</span>` : ''}
        </div>
      </div>
      <div class="topActions">
        <button class="btn primary" id="shareBtn" type="button">Share</button>
        <button class="btn" id="copyBtn" type="button">Copy page URL</button>
      </div>
    </div>

    ${sectionHtml('Social', groups.social)}
    ${sectionHtml('Payments', groups.payments)}
    ${sectionHtml('Contact', groups.contact)}
    ${sectionHtml('Other', groups.other)}

    ${config.footerNote ? `<footer>${escapeHtml(config.footerNote)}</footer>` : ''}
  </div>

  <script>
    (function(){
      const toast = (msg) => {
        const n = document.createElement('div');
        n.textContent = msg;
        n.style.position='fixed';
        n.style.bottom='16px';
        n.style.left='50%';
        n.style.transform='translateX(-50%)';
        n.style.background='rgba(0,0,0,.75)';
        n.style.color='#fff';
        n.style.padding='10px 12px';
        n.style.border='1px solid rgba(255,255,255,.18)';
        n.style.borderRadius='12px';
        n.style.zIndex='9999';
        n.style.fontSize='13px';
        n.style.maxWidth='92vw';
        n.style.boxShadow='0 10px 30px rgba(0,0,0,.35)';
        document.body.appendChild(n);
        setTimeout(() => { n.style.opacity='0'; n.style.transition='opacity .18s ease'; }, 1200);
        setTimeout(() => n.remove(), 1450);
      };

      // Handle @handles
      document.querySelectorAll('a.card[data-handle]').forEach(a => {
        a.addEventListener('click', (e) => {
          e.preventDefault();
          const handle = a.getAttribute('data-handle') || '';
          if (!handle) return;
          navigator.clipboard?.writeText(handle).then(() => toast('Copied ' + handle)).catch(() => toast(handle));
        });
      });

      const copyBtn = document.getElementById('copyBtn');
      const shareBtn = document.getElementById('shareBtn');

      if (copyBtn){
        copyBtn.addEventListener('click', () => {
          const url = location.href;
          navigator.clipboard?.writeText(url).then(() => toast('Copied URL')).catch(() => toast(url));
        });
      }

      if (shareBtn){
        shareBtn.addEventListener('click', async () => {
          const data = { title: document.title, text: document.title, url: location.href };
          if (navigator.share){
            try{ await navigator.share(data); }catch{ /* user cancelled */ }
          } else {
            navigator.clipboard?.writeText(location.href).then(() => toast('Copied URL')).catch(() => toast('Copy failed'));
          }
        });
      }
    })();
  <\/script>
</body>
</html>`;
  }

  function updatePreview(){
    const html = buildLandingPageHtml(state);
    const doc = el.preview.contentDocument;
    if (!doc) {
      el.preview.srcdoc = html;
      return;
    }
    el.preview.srcdoc = html;
  }

  function updateAll(){
    readStateFromInputs();
    validate();
    updatePreview();
    el.linkCount.textContent = `${state.links.length} link${state.links.length===1?'':'s'}`;
  }

  // --- Builder wire-up ---
  const watch = [
    el.displayName, el.headline, el.subheadline, el.accent, el.bgMode, el.bgBase, el.avatarUrl,
    el.email, el.phone, el.location, el.website,
    el.pageTitle, el.metaDesc, el.footerNote
  ];
  for (const w of watch){
    w.addEventListener('input', updateAll);
    w.addEventListener('change', updateAll);
  }

  el.addLinkBtn.addEventListener('click', () => addLink({ label: "New link", category: "other" }));

  el.addDefaultsBtn.addEventListener('click', () => {
    // Add defaults only if they aren't already present by label
    const existing = new Set(state.links.map(l => (l.label||"").trim().toLowerCase()));
    const toAdd = COMMON_DEFAULTS.filter(d => !existing.has(d.label.toLowerCase()));
    if (!toAdd.length){ toast("Defaults already added"); return; }
    for (const d of toAdd) addLink(d);
    toast(`Added ${toAdd.length} defaults`);
  });

  el.clearLinksBtn.addEventListener('click', () => {
    state.links = [];
    renderLinksEditor();
    updateAll();
  });

  el.exportBtn.addEventListener('click', () => {
    readStateFromInputs();
    const html = buildLandingPageHtml(state);
    downloadText('index.html', html);
  });

  el.copyHtmlBtn.addEventListener('click', async () => {
    readStateFromInputs();
    const html = buildLandingPageHtml(state);
    await copyText(html);
  });

  el.openInNewTabBtn.addEventListener('click', () => {
    readStateFromInputs();
    const html = buildLandingPageHtml(state);
    const blob = new Blob([html], {type:'text/html'});
    const url = URL.createObjectURL(blob);
    window.open(url, '_blank', 'noopener');
    setTimeout(() => URL.revokeObjectURL(url), 1500);
  });

  // Save/load builder state
  const LS_KEY = 'landing_page_builder_state_v1';

  el.saveStateBtn.addEventListener('click', () => {
    readStateFromInputs();
    localStorage.setItem(LS_KEY, JSON.stringify(state));
    toast('Saved');
  });

  el.loadStateBtn.addEventListener('click', () => {
    const raw = localStorage.getItem(LS_KEY);
    if (!raw){ toast('Nothing saved'); return; }
    try{
      const parsed = JSON.parse(raw);
      state = sanitizeImportedState(parsed);
      setInputValuesFromState();
      toast('Loaded');
    }catch{
      toast('Save is corrupted');
    }
  });

  el.resetStateBtn.addEventListener('click', () => {
    state = structuredClone(DEFAULTS);
    setInputValuesFromState();
    toast('Reset');
  });

  // JSON import/export
  el.downloadJsonBtn.addEventListener('click', () => {
    readStateFromInputs();
    downloadJson('landing-page-settings.json', state);
  });

  el.importJsonBtn.addEventListener('click', () => el.importJsonFile.click());

  el.importJsonFile.addEventListener('change', async (e) => {
    const f = e.target.files?.[0];
    if (!f) return;
    try{
      const text = await f.text();
      const parsed = JSON.parse(text);
      state = sanitizeImportedState(parsed);
      setInputValuesFromState();
      toast('Imported');
    }catch{
      toast('Import failed');
    } finally {
      el.importJsonFile.value = '';
    }
  });

  function sanitizeImportedState(obj){
    const out = structuredClone(DEFAULTS);
    if (!obj || typeof obj !== 'object') return out;

    for (const k of Object.keys(out)){
      if (k === 'links') continue;
      if (typeof obj[k] === 'string') out[k] = obj[k];
      if (k === 'bgMode' && typeof obj.bgMode === 'string') out.bgMode = obj.bgMode;
    }

    const links = Array.isArray(obj.links) ? obj.links : [];
    out.links = links
      .filter(l => l && typeof l === 'object')
      .map(l => ({
        id: typeof l.id === 'string' ? l.id : uid(),
        label: typeof l.label === 'string' ? l.label : 'Link',
        url: typeof l.url === 'string' ? l.url : '',
        category: typeof l.category === 'string' ? l.category : 'other',
        icon: typeof l.icon === 'string' ? l.icon : '',
        enabled: typeof l.enabled === 'boolean' ? l.enabled : true,
      }));

    return out;
  }

  // Init
  // Load from localStorage if present, else defaults
  try{
    const raw = localStorage.getItem(LS_KEY);
    if (raw){
      const parsed = JSON.parse(raw);
      state = sanitizeImportedState(parsed);
    }
  }catch{}

  // Ensure at least a couple of links so preview isn't empty
  if (!state.links.length){
    state.links = [
      { id: uid(), label: 'GitHub', url: 'https://github.com/', category: 'social', icon: 'github', enabled: true },
      { id: uid(), label: 'Email', url: 'mailto:', category: 'contact', icon: 'mail', enabled: true },
      { id: uid(), label: 'PayPal', url: 'https://paypal.me/', category: 'payments', icon: 'heart', enabled: true },
    ];
  }

  setInputValuesFromState();
})();
</script>
</body>
</html>
